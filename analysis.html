<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sleep Survey Results</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { margin: 0; padding: 0; font-family: 'Baloo 2', cursive; background: linear-gradient(120deg, #eaf6ff 0%, #fef9f4 100%); color: #2D3A5E; min-height: 100vh; position: relative; }
    .bg-emoji { position: fixed; z-index: 0; pointer-events: none; opacity: 0.22; font-size: 2.5rem; user-select: none; animation: floating 8s ease-in-out infinite alternate; }
    .bg-e1 { left: 5vw;  top: 4vh;    font-size: 3.2rem; animation-delay: 0s;}
    .bg-e2 { right: 4vw; top: 6vh;    font-size: 2.8rem; animation-delay: 2.2s;}
    .bg-e3 { left: 8vw;  bottom: 9vh; font-size: 2.7rem; animation-delay: 1.3s;}
    .bg-e4 { right: 10vw; bottom: 5vh; font-size: 3rem;  animation-delay: 3.7s;}
    .bg-e5 { left: 47vw; top: 87vh;   font-size: 2rem;   animation-delay: 5s;}
    .bg-e6 { left: 17vw; top: 40vh;   font-size: 2.3rem; animation-delay: 3.1s;}
    .bg-e7 { right: 20vw; top: 45vh;  font-size: 2.1rem; animation-delay: 1.7s;}
    .bg-e8 { left: 40vw; bottom: 14vh;font-size: 2.5rem; animation-delay: 4.4s;}
    .bg-e9 { right: 32vw; bottom: 20vh;font-size: 2.2rem; animation-delay: 2.9s;}
    .bg-e10 {left: 14vw; top: 16vh;   font-size: 2.4rem; animation-delay: 0.6s;}
    @keyframes floating { 0%{ transform: translateY(0) scale(1);} 100%{ transform: translateY(16px) scale(1.07);} }

    .main-container { max-width: 760px; margin: 38px auto 36px auto; background: white; border-radius: 18px; box-shadow: 0 8px 28px rgba(0,0,0,0.07); padding: 30px 26px 28px 26px; position: relative; z-index: 1; }
    h2 { text-align: center; color: #2D3A5E; font-size: 2.2rem; margin-bottom: 26px; font-weight: 700; letter-spacing: 1.5px; }

    .top-blocks { display: flex; flex-wrap: wrap; gap: 34px; justify-content: space-between; margin-bottom: 24px; }
    .left-top { flex: 1; min-width: 260px; max-width: 350px; }

    .score-main { background: #FFF5CC; padding: 15px 18px 13px 18px; border-radius: 12px; color: #B68900; font-size: 1.3rem; font-weight: bold; margin-bottom: 10px; letter-spacing: 1px; box-shadow: 0 2px 10px #FFF9D0; display: flex; align-items: center; gap: 10px; }
    .score-grade { background: #FFD43B; color: white; border-radius: 8px; padding: 4px 10px; margin-left: 14px; font-size: 1rem; font-weight: 600; letter-spacing: 0.6px; }

    .feedback { background: #E3FCEF; padding: 11px 14px; border-radius: 10px; color: #1A8C71; font-size: 1.09rem; margin-bottom: 11px; font-weight: 500; box-shadow: 0 1px 8px #14BF9622; }
    .raw-data { background: #F0F4F8; border-radius: 8px; font-size: 1.02rem; padding: 11px 11px 10px 14px; color: #506080; margin-bottom: 0; border-left: 4px solid #E0E7FF; box-shadow: 0 1px 4px #E0E7FF12; min-width: 200px; width: 100%; }

    .chart-panel { flex: 1; background: #f7fafc; border-radius: 15px; box-shadow: 0 2px 8px #cbd5e0; padding: 16px; text-align: center; max-width: 340px; min-width: 220px; margin: auto; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .chart-panel h3 { color: #2D3A5E; font-size: 1.1rem; font-weight: 600; margin-bottom: 0.6rem; margin-top: 0; letter-spacing: 0.5px; background: none; }


    canvas#radarChart {
      width: 100% !important;
      max-width: 260px; min-width: 160px;
      aspect-ratio: 1/1; margin: 0 auto;
      background: transparent;  
      border-radius: 0;        
      box-shadow: none;        
      display: block;
    }

    .tips-bottom-block { margin-top: 38px; margin-bottom: 10px; background: #FEF3C7; border-radius: 13px; box-shadow: 0 2px 14px #ffe0821a; padding: 22px 20px 17px 20px; max-width: 700px; margin-left: auto; margin-right: auto; }
    .tips-title { text-align: center; color: #B68900; font-size: 1.16rem; font-weight: 700; margin-bottom: 10px; letter-spacing: 1px; display: flex; align-items: center; gap: 6px; justify-content: center; }
    .tips-list { display: flex; flex-direction: column; gap: 8px; max-width: 650px; margin: 0 auto; }
    .tip-item { background: #FFF7ED; border-left: 5px solid #FFD43B; padding: 10px 16px 10px 16px; border-radius: 8px; color: #9C4221; font-size: 1.04rem; box-shadow: 0 1px 6px #FFD43B14; animation: fadeIn 1.1s; }
    .tip-title { font-weight: 600; color: #B68900; font-size: 1.09em; display: flex; align-items: center; gap: 5px; }

    .go-explore-btn { display: block; margin: 30px auto 0 auto; background: #3B82F6; color: white; font-size: 1rem; padding: 13px 28px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; letter-spacing: 0.5px; transition: background 0.2s ease; box-shadow: 0 2px 12px #60a5fa18; }
    .go-explore-btn:hover { background: #2563EB; }
  
    /*Bottom-right image*/
    .side-sleep{
      position: fixed;
      right: calc(16px + env(safe-area-inset-right, 0px));
      bottom: calc(16px + env(safe-area-inset-bottom, 0px));
      width: 180px;      
      height: auto;
      z-index: 10;       
      pointer-events: none;
    }
    @media (max-width: 480px){
      .corner-panda{ width: 80px; right: 10px; bottom: 10px; }
    }

  
    /*Left-center image*/
    .corner-panda{
      position: fixed;
      left: calc(16px + env(safe-area-inset-left, 0px));
      top: 50%;
      transform: translateY(-50%);
      width: 160px;    
      height: auto;
      z-index: 10;
      pointer-events: none; 
    }
    @media (max-width: 480px){
      .side-sleep{ width: 96px; left: 8px; }
    }

  </style>
</head>
<body>
  <!-- BGemoji -->
  <div class="bg-emoji bg-e1">üåô</div>
  <div class="bg-emoji bg-e2">‚≠ê</div>
  <div class="bg-emoji bg-e3">üß∏</div>
  <div class="bg-emoji bg-e4">üêò</div>
  <div class="bg-emoji bg-e5">‚õµ</div>
  <div class="bg-emoji bg-e6">üåº</div>
  <div class="bg-emoji bg-e7">üé©</div>
  <div class="bg-emoji bg-e8">üå∏</div>
  <div class="bg-emoji bg-e9">üõèÔ∏è</div>
  <div class="bg-emoji bg-e10">üò¥</div>

  <div class="main-container">
    <h2>üõå Sleep Survey Results</h2>
    <div class="top-blocks">
      <div class="left-top">
        <div id="scoreBlock" class="score-main"></div>
        <div id="feedback" class="feedback"></div>
        <div id="rawData" class="raw-data"></div>
      </div>
      <div class="chart-panel">
        <h3>Sleep Dimension Radar</h3>
        <canvas id="radarChart" width="300" height="300"></canvas>
      </div>
    </div>
    <div class="tips-bottom-block">
      <div class="tips-title">‚ú® Top 3 Tips</div>
      <div id="top3Summary" class="tips-list"></div>
    </div>
    <button class="go-explore-btn" onclick="window.location.href='explore.html'">üîç Explore Sleep Tips</button>
  </div>

  <script>

    const dimensionMeta = [
      { key: 'q1', label: 'Scary Dreams', abs_coef: 1.543236, emoji: 'üêª' },
      { key: 'q2', label: 'Night Awakenings', abs_coef: 0.499543, emoji: 'üåõ' },
      { key: 'q3', label: 'Bedtime Resistance', abs_coef: 0.275583, emoji: 'üß∏' },
      { key: 'q4', label: 'Short Sleep Duration', abs_coef: 0.272544, emoji: 'üïí' },
      { key: 'q5', label: 'Breathing Issues in Sleep', abs_coef: 0.269935, emoji: 'üêò' },
      { key: 'q6', label: 'Daytime Sleepiness', abs_coef: 0.265018, emoji: 'üåû' },
      { key: 'q7', label: 'Sleep Anxiety', abs_coef: 0.159954, emoji: 'üê±' },
      { key: 'q8', label: 'Sleep Onset Delay', abs_coef: 0.15, emoji: 'ü¶â' } 
    ];

    const data = JSON.parse(sessionStorage.getItem('sleepSurveyData') || '{}');
    const totalWeight = dimensionMeta.reduce((sum, d) => sum + d.abs_coef, 0);
    dimensionMeta.forEach(d => { const val = data[d.key] || 0; const norm = val / 4; d.contrib = norm * (d.abs_coef / totalWeight); });
    const rawScore = dimensionMeta.reduce((sum, d) => sum + d.contrib, 0);

    let dimensionScores = {}; dimensionMeta.forEach(d => { dimensionScores[d.label] = data[d.key] || 0; });
    sessionStorage.setItem('dimensionScores', JSON.stringify(dimensionScores));

    const grade = rawScore < 0.2 ? 'Excellent' : rawScore < 0.4 ? 'Good' : rawScore < 0.6 ? 'Average' : rawScore < 0.8 ? 'Needs Improvement' : 'Pay Attention';
    document.getElementById("scoreBlock").innerHTML = `Total Score: <b>${(rawScore * 100).toFixed(1)}</b> <span class="score-grade">${grade}</span>`;
    document.getElementById("feedback").innerText = grade === 'Excellent' ? 'Your sleep looks quite healthy. Keep it up!' : grade === 'Good' ? 'You scored moderate. Consider refining your bedtime routine.' : 'Try improving your sleep habits for better focus and energy!';
    document.getElementById("rawData").innerHTML = dimensionMeta.map((d) => `${d.emoji} ${d.label.replace(/([A-Z])/g," $1").replace(/^ /,"")}: <b>${data[d.key]||0}/4</b>`).join("<br>");

    const ctx = document.getElementById('radarChart').getContext('2d');
    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: dimensionMeta.map(d => d.label.replace(/([A-Z])/g," $1").replace(/^ /,"")),
        datasets: [{
          label: "Your Score",
          data: dimensionMeta.map(d => data[d.key] || 0),
          fill: false,
            backgroundColor: 'rgba(59,130,246,0.16)',
          borderColor: '#3B82F6',
          borderWidth: 2,
          pointBackgroundColor: '#3B82F6'
        }]
      },
      options: {
        responsive: true,
        scales: {
          r: {
            suggestedMin: 0,
            suggestedMax: 4,
            ticks: { stepSize: 1, color: "#4B5563" },
            pointLabels: {
              color: "#2D3A5E",
              font: { size: 12 },
              padding: 8,
              callback: function(label) {
                const words = String(label).split(' ');
                if (words.length <= 1) return label;
                const mid = Math.ceil(words.length / 2);
                return [
                  words.slice(0, mid).join(' '),
                  words.slice(mid).join(' ')
                ];
              }
            }
          }
        },
        plugins: { legend: { display: false } }
      }
    });

    const top3 = [...dimensionMeta].sort((a, b) => b.contrib - a.contrib).slice(0,3);
    const summaryDiv = document.getElementById('top3Summary');
    top3.forEach(d => {
      const pools = {
        Parasomnias: [
          "Take a few deep breaths before bed to help your body relax.",
          "Share happy things from your day with your family at night.",
          "Try a soft pillow to make sleep more comfortable.",
          "Listen to gentle music before sleeping.",
          "Help your family make your bedroom cozy and safe together."
        ],
        NightWakings: [
          "Drink less water before bedtime to wake up less at night.",
          "Soak your feet in warm water before bed to help your body relax.",
          "If you wake up at night, close your eyes and take three deep breaths.",
          "Make a regular bedtime routine with your family.",
          "If you wake up, gently pull your blanket back on and lie down again."
        ],
        BedtimeResistance: [
          "Have a bedtime story time with your family every night.",
          "Get your favorite stuffed toy ready for sleep before bed.",
          "Plan your playtime and quiet time with your family in the evening.",
          "Lie quietly in bed after getting in, no more playing.",
          "Let your family know when you are ready for bed."
        ],
        SleepOnsetDelay: [
          "Take three deep breaths in bed to help your body calm down.",
          "Turn off all electronics before going to bed.",
          "Listen to soft music before sleeping.",
          "Close your eyes and count little animals until you fall asleep.",
          "Go to bed at the same time every night."
        ],
        SleepDuration: [
          "Be active during the day.",
          "Get ready for bed a little earlier at night.",
          "Make a set bedtime schedule with your family.",
          "Keep nap time under 30 minutes.",
          "Turn off the lights on time every night."
        ],
        SleepAnxiety: [
          "Cuddle your favorite stuffed toy when sleeping.",
          "Share the happiest thing from your day with your family before bed.",
          "Pick out a night light you like.",
          "Listen to a bedtime story at night.",
          "Create a special 'good night' routine with your parents."
        ],
        SleepDisorderedBreathing: [
          "Try sleeping on your side or back to help you breathe better.",
          "Ask your family to help you find a comfy sleeping position.",
          "Keep your room fresh and airy.",
          "Tell your family if your nose is stuffy.",
          "Don't use a blanket that's too thick at night."
        ],
        DaytimeSleepiness: [
          "Eat a healthy breakfast every morning.",
          "Move and play during the day, and go to bed early at night.",
          "Keep nap time short, no more than 30 minutes.",
          "Open the curtains and let sunlight in after you wake up.",
          "Drink water during the day to stay energized."
        ]
      };
      const pool = pools[d.label] || [];
      const tipText = pool.length ? pool[Math.floor(Math.random()*pool.length)] : '';
      const pct = (d.contrib * 100).toFixed(1);
      const tip = document.createElement('div');
      tip.className = 'tip-item';
      tip.innerHTML = `<div class="tip-title">üí° ${d.emoji} ${d.label.replace(/([A-Z])/g," $1").replace(/^ /,"")} <span style="color:#FFD43B;font-weight:400">(${pct}% impact)</span></div>
      <div>${tipText}</div>`;
      summaryDiv.appendChild(tip);
    });
  </script>

  <!-- Bottom-righ image -->
  <img class="corner-panda" src="pictures/panda.png" alt="panda illustration" decoding="async" loading="lazy" />

  <!-- Left-center image -->
  <img class="side-sleep" src="pictures/sleep.png" alt="Sleep illustration" decoding="async" loading="lazy" />
</body>
</html>
